<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/css/bootstrap.min.css" integrity="sha384-2hfp1SzUoho7/TsGGGDaFdsuuDL0LX2hnUp6VkX3CUQ2K4K+xjboZdsXyp4oUHZj" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <style>
    body {
      font-weight: 300;
    }
  </style>
</head>
<body style='background-color: #eee'>
  <div class='container'>
    <div id='questions' class='row'></div>
  </div>
  <div id='qaModal' class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
          <p id='question'></p>
          <p id='answer'></p>
        </div>
      </div>
    </div>
  </div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js" integrity="sha384-THPy051/pYDQGanwU6poAc/hOdQxjnOEXzbT+OuUAFqNqFjL+4IGLBgCJC3ZOShY" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.2.0/js/tether.min.js" integrity="sha384-Plbmg8JY28KFelvJVai01l8WyZzrYWG825m+cZ0eDDS1f7d/js6ikvy1+X+guPIB" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.4/js/bootstrap.min.js" integrity="sha384-VjEeINv9OSwtWFLAtmc4JCtEJXXBub00gtSnszmspDLCtC0I4z4nqz7rEFbIZLLU" crossorigin="anonymous"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="http://coffeescript.org/extras/coffee-script.js"></script>
  <script type="text/coffeescript">
    row = (d) ->
      id: d.Id
      day: d.Day
      question: d.Question
      answer: d.Answer

    color = d3.scaleOrdinal d3.schemeCategory20
    div = d3.select '#questions'
    d3.tsv 'data.tsv', row, (err, rows) ->

      card =
        div.selectAll('.card').data(rows).enter()
            .append 'div'
              .attr 'class', 'col-xs-12 col-sm-12 col-md-6 col-lg-4'
              .append 'div'
                .classed 'card', true
                .append 'div'
                  .classed 'card-block', true

      card.append 'h4'
          .classed 'card-title', true
          .style 'color', (d) -> color d.day
          .text (d) -> d.id

      # audio and button
      card.each ->
          sel = d3.select @
          sel.append 'button'
            .attr 'class', 'btn btn-link material-icons control'
            .text 'play_arrow'
            .on 'click', ->
              switch sel.select('.control').text()
                when 'play_arrow'
                  sel.select('audio').node().play()
                when 'stop'
                  sel.select('audio').node().pause()
                  sel.select('audio').node().currentTime = 0
                else
                  sel.select('audio').node().pause()
          sel.append 'audio'
            .on 'play', (d) -> sel.select('.control').text 'stop'
            .on 'pause', (d) -> sel.select('.control').text 'play_arrow'
            .append 'source'
              .attr 'src', (d) -> "questions/#{d.id.toLowerCase()}.mp3"
              .attr 'type', 'audio/mpeg'

      # qa modal
      card.append 'button'
            .attr 'class', 'btn btn-link material-icons'
            .text 'question_answer'
            .on 'click', (d) ->
              d3.select('#qaModal #question').text d.question
              d3.select('#qaModal #answer').text d.answer
              $('#qaModal').modal 'show'

      $('.collapse').collapse('hide')
  </script>
</body>
</html>
